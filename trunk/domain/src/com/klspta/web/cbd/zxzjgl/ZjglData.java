package com.klspta.web.cbd.zxzjgl;

import java.text.DecimalFormat;
import java.util.List;
import java.util.Map;

import com.klspta.base.AbstractBaseBean;

/*******************************************************************************
 * 
 * <br>
 * Title:资金管理数据库交互类 <br>
 * Description:查、跟新等操作 <br>
 * Author:朱波海 <br>
 * Date:2013-12-26
 */
public class ZjglData extends AbstractBaseBean {
	private static String[] months = {"CQYE", "YY", "EY", "SANY", "SIY", "WY", "LY", "QY","BAY", "JY", "SIYUE", "SYY", "SEY" ,"LRSP" };
	
	public static final String SQL_ZJZC_FATHER = "select t.tree_name as tree_name, sum(t.YSFY) as ysfy ,sum(t.CQYE) as cqye,sum(t.YFSDZ) as yfsdz,"
                                               + " sum(t.yy) as yy ,sum(t.ey) as ey,sum(t.sany) as sany,sum(t.siy) as siy,"
                                               + " sum(t.wy) as wy,sum(t.ly) as ly,sum(t.qy) as qy,sum(t.bay) as bay,sum(t.jy) as jy"
                                               + ",sum(t.siyue) as siyue,sum(t.syy) as syy ,sum(t.sey) as sey ,sum(t.LRSP) as lrsp,sum(t.sort) as sort ,t.leval as leval "
                                               + "from xmzjgl_mxb t  where t.rq=? group by t.tree_name,t.leval order by sort asc";
	public static final String SQL_ZJLR_FATHER = "select t.tree_name as tree_name,t.tree_id as tree_id ,t.lj as lj,t.parent_id as parent_id from  XMZJGL_LR_view t where tree_id=?  and rq=? ";

	public List<Map<String, Object>> getFatherData( String year, String sql) {
		List<Map<String, Object>> list =null;
		list = query(sql, YW, new Object[] {  year});
		return list;
	}

	public List<Map<String, Object>> getZJZCChild(String treeName, String parentID, String year) {
		String sql = "";
		List<Map<String, Object>> list = null;
		int cols[] = { 0, 0, 0, 0, 0, 0, 0, 0 }; 
		sql = "select * from  XMZJGL_ZC_view where parent_id=? and tree_name=? and rq=? order by sort";                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
		list = query(sql, YW, new Object[] { parentID,  treeName, year });
		if (list.size() == 8) {
			for( int i = 0; i < months.length; i++){
				for (int j = 0; j < 8; j++) {
					cols[j] = Integer.parseInt(list.get(j).get(months[i]).toString());
				}
				list.get(0).remove(months[i]);
				list.get(0).put(months[i], cols[1] + cols[2] + cols[3] + cols[4] + cols[5]);
				
				list.get(7).remove(months[i]);
				list.get(7).put(months[i], cols[1] + cols[2] + cols[3] + cols[4] + cols[5] - cols[6]);
			}
			for (int i = 0; i < 8; i++) {
				cols[i] = Integer.parseInt(list.get(i).get("JL2").toString());
			}
			list.get(0).remove("JL2");
			list.get(0).put("JL2", cols[1] + cols[2] + cols[3] + cols[4] + cols[5]);
			list.get(7).remove("JL2");
			list.get(7).put("JL2", cols[1] + cols[2] + cols[3] + cols[4] + cols[5] - cols[6]);
			list.get(0).remove("YFSDZ");
			list.get(0).put("YFSDZ", cols[6]+"");
			list.get(0).remove("ZJJD");
			double ysfy = Double.parseDouble(list.get(0).get("YSFY")==null? "0" :list.get(0).get("YSFY").toString());
			DecimalFormat df = new DecimalFormat("#.00");
			list.get(0).put("ZJJD",ysfy==0? "0" : df.format(cols[6]/ysfy*100) +"%");
		}
		
		return list;
	}
	
	public List<Map<String, Object>> getZJLR_child(String tree_name, String parent_id, String year) {
		String sql = "";
		List<Map<String, Object>> list = null;
		sql = "select * from  XMZJGL_LR_view where parent_id=? and tree_name=? and rq=? ";
		list = query(sql, YW, new Object[] { parent_id, tree_name, year });
		return list;
	}
}
